<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Linkar</title>

   <link rel="stylesheet" href="home.css">
</head>

<body>

  <!-- ===== BARRA SUPERIOR (HEADER) ===== -->
  <header class="topo">
    <!-- Lado esquerdo -->
    <div class="user-card">
      <div class="user-avatar">E</div>
      <span class="user-name">Linkar</span>
    </div>

    <!-- Centro (menu com √≠cones + texto) -->
    <nav class="menu-centro">
      <a href="#" class="nav-link">
        <img src="imagem/lar.png" alt="Feed" class="icon"> Feed
      </a>
      <a href="#" class="nav-link">
        <img src="imagem/agenda.png" alt="Agenda" class="icon"> Agenda
      </a>
    </nav>

    <!-- Lado direito -->
    <div class="icones-topo">
      <button class="btn-icone" aria-label="Buscar">
        <img src="imagem/lupa-arredondada.png" alt="Buscar">
      </button>
      <button class="btn-icone" aria-label="Notifica√ß√µes">
        <img src="imagem/sino.png" alt="Notifica√ß√µes">
      </button>
      <button class="btn-icone btn-icone--green" aria-label="Perfil">
        <img src="imagem/pessoa1.png" alt="Perfil">
      </button>
    </div>
  </header>

  <!-- ===== CONTE√öDO CENTRAL (EDITAR PERFIL) ===== -->
  <main class="centraliza">
    <div class="container">
      <div class="profile-card">
        <div class="profile-header">
          <div class="avatar">
            <!-- caminho da imagem do avatar -->
            <img src="imagem/pessoa1.png" alt="Avatar do usu√°rio">
          </div>

          <div class="profile-texts">
            <h2>Editar Perfil</h2>

          </div>
        </div>



    <form class="postar" th:action="@{/salvar-post}" method="post" enctype="multipart/form-data">
        <label>Conte√∫do:</label>
        <textarea class="Escreva" name="conteudo" rows="4" placeholder="Escreva algo..."></textarea>

        
        <label>Foto:</label>
        <input type="file" name="foto" accept="image/*" onchange="previewImage(event)">
        
        <label>Visibilidade:</label>
        <select  name="categoria">
            <option value="TODOS">todos</option>
			<option value="ALUNO">Alunos</option>
            <option value="PROFESSOR">Professores</option>
			<option value="DIRECAO">Gest√£o</option>
        </select>
        <div class="preview" id="preview"></div>

        <button class="Publicar" type="submit">Publicar</button>
    </form>

    <script>
        function previewImage(event) {
            const preview = document.getElementById('preview');
            preview.innerHTML = '';
            const file = event.target.files[0];
            if (file) {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                preview.appendChild(img);
            }
        }
    </script>

<div class="feed-container">




    <!-- ABAS -->
    <div class="tabs">
        <a class="tab"
           th:classappend="${categoriaAtual == 'TODOS'} ? ' active'"
           href="/feed?categoria=TODOS">Todos</a>

        <a class="tab"
           th:if="${usuario != null and (usuario.tipo == 'ALUNO' or usuario.tipo == 'PROFESSOR' or usuario.tipo == 'DIRECAO')}"
           th:classappend="${categoriaAtual == 'ALUNOS'} ? ' active'"
           href="/feed?categoria=ALUNOS">Alunos</a>

        <a class="tab"
           th:if="${usuario != null and (usuario.tipo == 'PROFESSOR' or usuario.tipo == 'DIRECAO')}"
           th:classappend="${categoriaAtual == 'PROFESSORES'} ? ' active'"
           href="/feed?categoria=PROFESSORES">Professores</a>

        <a class="tab"
           th:if="${usuario != null and usuario.tipo == 'DIRECAO'}"
           th:classappend="${categoriaAtual == 'DIRECAO'} ? ' active'"
           href="/feed?categoria=DIRECAO">Dire√ß√£o</a>
    </div>

    <!-- SEM POSTS -->
    <div th:if="${#lists.isEmpty(posts)}" style="text-align:center; margin-top:20px;">
        Nenhum post encontrado nessa categoria.
    </div>

    <!-- LISTA DE POSTS -->
    <div th:each="post : ${posts}" class="post">

        <div class="post-header">
            <h3 th:text="${post.usuario.nome}"></h3>
            <span th:text="${#temporals.format(post.criadoEm, 'dd/MM HH:mm')}"></span>
        </div>

        <p th:text="${post.conteudo}"></p>

        <img th:if="${post.fotoUrl != null}" th:src="${post.fotoUrl}"
             style="max-width:100%; border-radius:8px; margin-top:10px;">

        <p style="font-size:12px; color:gray;">
            Categoria: <b th:text="${post.categoria}"></b>
        </p>

        <!-- CURTIDAS -->
        <button class="btn"
                th:attr="data-id=${post.id}"
                onclick="curtirPost(this)">
            ‚ù§Ô∏è Curtir (<span th:attr="id='qtd-curtidas-' + ${post.id}"
                             th:text="${post.qtdCurtidas}"></span>)
        </button>

        <!-- BOT√ÉO VER COMENT√ÅRIOS -->
        <button class="btn"
                th:attr="id='toggle-'+${post.id}"
                onclick="toggleComentarios([[${post.id}]])">
            üí¨ Coment√°rios
        </button>

        <!-- LISTA DE COMENT√ÅRIOS -->
        <div class="comentarios"
             th:attr="id='comentarios-'+${post.id}"
             style="display:none; margin-top:10px;">

            <div th:each="comentario : ${post.comentarios}" class="comentario">
                <strong th:text="${comentario.usuario.nome}"></strong>:
                <span th:text="${comentario.conteudo}"></span>
            </div>

            <!-- NOVO COMENT√ÅRIO -->
            <form th:if="${usuario != null}"
                  th:action="@{/posts/comentar}" method="post" style="margin-top:10px;">
                <input type="hidden" name="postId" th:value="${post.id}">
                <input type="text" name="texto" placeholder="Escreva um coment√°rio...">
                <button class="btn" type="submit">Enviar</button>
            </form>

        </div>

    </div> <!-- fim each -->

</div>

<!-- SCRIPTS -->
<script>
    function toggleComentarios(id) {
        let box = document.getElementById("comentarios-" + id);
        box.style.display = box.style.display === "none" ? "block" : "none";
    }

    function curtirPost(btn) {
        let id = btn.getAttribute("data-id");

        fetch("/posts/" + id + "/curtir", { method: "POST" })
            .then(r => r.json())
            .then(data => {
                document.getElementById("qtd-curtidas-" + id).innerText = data.qtd;0
            });
    }
</script>

</body>
</html>
